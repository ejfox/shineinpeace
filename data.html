
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Shine in Peace</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="css/bootstrap.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    
	<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.5/leaflet.css" />
	<!--[if lte IE 8]>
	     <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.5/leaflet.ie.css" />
	 <![endif]-->
	<script src="http://cdn.leafletjs.com/leaflet-0.5.1/leaflet.js"></script>
	<script src="js/tabletop.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/ICanHaz.js" type="text/javascript" charset="utf-8"></script>
	
    <style type="text/css">
      body {
        padding-top: 60px;
        padding-bottom: 40px;
      }
    </style>
    <!-- ><link href="css/bootstrap-responsive.css" rel="stylesheet"> -->

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="/js/html5shiv.js"></script>
    <![endif]-->


  </head>

  <body>

    <div class="navbar navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="brand" href="#">Shine in Peace</a>
          <div class="nav-collapse collapse">
            <ul class="nav">
              <li class="active"><a href="#">Home</a></li>
              <li><a href="topics.html">Topics</a></li>
              <li><a href="#about">About the project</a></li>			  
              <li><a href="#contact">Contact</a></li>
            </ul>
			
			<form class="navbar-search pull-right">
			  <input type="text" class="search-query" placeholder="Search by name or street">
			</form>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

    <div class="container-fluid" id="data-container">
		<div class="row-fluid">
            <!--
			<div class="span4" id="intro">
				<h2>Intro text</h2>
				<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam sagittis molestie urna, ut gravida nunc facilisis eget. Phasellus dictum risus ut quam lobortis non malesuada velit dictum. Cras congue viverra mauris, sed dignissim tortor volutpat sit amet. Nulla vulputate nisl non urna commodo non iaculis massa semper. Suspendisse potenti. Donec et gravida ipsum. Vestibulum ut odio vitae lorem molestie aliquam. Sed volutpat consequat eros non placerat. Maecenas ut nisi libero, nec tempor nunc. Nunc leo leo, dictum nec euismod eget, sagittis ut massa. Donec venenatis nibh et ipsum consectetur quis volutpat ante blandit. Praesent interdum sodales odio, a iaculis nibh consectetur quis.</p>
			</div>
        -->
		
			<div class="span12" id="map">
                <h2 id="loading">Loading....</h2>
                
                <script id="homicidePop" type="text/html">
                <h2>Homicide</h2>
                <div>Number of reported victims: {{noofvictims}}</div>
                <div>{{victims}} killed on {{date}} at {{time}}</div>
                <div>{{address}}</div>
                <div class="detailed-description">
                    I am a detailed description of the event. Track through OPD with RD# {{rdNumber}}
                </div>
                </script>
                
                <script id="injuryPop" type="text/html">
                <h2>Shooting with Injury</h2>
                <div>Number of reported victims: {{noofvictims}}</div>
                <div>{{date}} at {{time}}</div>
                <div>{{address}}</div>
                <div class="detailed-description">
                    I am a detailed description of the event. Track through OPD with RD# {{rdNumber}}
                </div>
                </script>
                
                <script id="noInjuryPop" type="text/html">
                <h2>Shooting with No Injury</h2>
                <div>Number of reported victims: {{noofvictims}}</div>
                <div>{{date}} at {{time}}</div>
                <div>{{address}}</div>
                <div class="detailed-description">
                    I am a detailed description of the event. Track through OPD with RD# {{rdNumber}}
                </div>
                </script>
                
                <script id="shootPop" type="text/html">
                <h2>Shooting</h2>
                <div>Number of reported victims: {{noofvictims}}</div>
                <div>{{date}} at {{time}}</div>
                <div>{{address}}</div>
                <div class="detailed-description">
                    I am a detailed description of the event. Track through OPD with RD# {{rdNumber}}
                </div>
                </script>

			</div>
		</div>
		
        <!-- 
		<div class="row-fluid">
			<div class="span3 topicstory">
				<h3>The Killings</h3>
				<img src="http://placehold.it/350x250" />
			</div>
			<div class="span3 topicstory">
				<h3>The Trauma</h3>
				<img src="http://placehold.it/350x250" />
			</div>
			<div class="span3 topicstory">
				<h3>The Solutions</h3>
				<img src="http://placehold.it/350x250" />
			</div>
			<div class="span3 topicstory">
				<h3>The Data</h3>
				<img src="http://placehold.it/350x250" />
			</div>			
		</div>
        -->
        
        <div id="behind-left">
            <h3>Behind left menu!</h3>
            <ul id="category-list">
                <li class="active"><img src="http://placehold.it/350x250" /></li>
                <li><img src="http://placehold.it/350x250" /></li>
                <li><img src="http://placehold.it/350x250" /></li>
                <li><img src="http://placehold.it/350x250" /></li>
            </ul>
        </div>
        
        <div id="behind-right">
            
            <div id="map-incidents">
                <h3>Filter Map</h3>
                <ul class="nav nav-pills nav-stacked">
                    <li><a href="#">Homicides</a></li>
                    <li><a href="#">Shootings with injuries</a></li>
                    <li><a href="#">Shootings with no injuries</a></li>
                </ul>
            </div>
        </div>
        
		
        <footer class="row-fluid span12" >
        	
        </footer>			





    </div><!--/.fluid-container-->

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="js/bootstrap.js"></script>
    
    <script type="text/javascript" charset="utf-8">
    $(document).ready(function(){        
        
        $('#category-list li img').click( function(){
            $('#category-list li').removeClass("active");
            $(this).parent().addClass("active");
    
        })
    
    
    
        /*    Create the map     */
    
        var pointData = [];

        //INITALIZE TABLETOP AND DATA POINTS
        $(document).ready(function($){
        	var public_spreadsheet_url = 'https://docs.google.com/spreadsheet/pub?key=0AnZDmytGK63SdHZoYWM5UklxaXI4bEpqS3cta1hid1E&output=html';
			
        	//initialize tabletop
        	function initTable() {
        		Tabletop.init( { 	key: public_spreadsheet_url,
        							callback: showInfo,
        							simpleSheet: true,
        							debug:true } );
		
        	}
	        
            function mapNewPoint(pointData){
                
                var homicidePop = ich.homicidePop(pointData, true);
                var injuryPop = ich.injuryPop(pointData, true);
                var noInjuryPop = ich.noInjuryPop(pointData, true);
                var shootPop = ich.shootPop(pointData, true);  
                
    			//place points
    			if (pointData.homicidetag == "TRUE"){                        
                    var pntLatLng = new L.LatLng(pointData.lat, pointData.lng)
                    homicidePoint = new L.circle(pntLatLng, 200, {
                        color: 'red',
                        stroke: false,
                        fillOpacity: 0.8
                        
                    }).addTo(map)
                    
                    homicidePoint.bindPopup(homicidePop)                        
    			}
    			else if (pointData.shootinjurytag == "TRUE") {
                    var pntLatLng = new L.LatLng(pointData.lat, pointData.lng)
                    homicidePoint = new L.circle(pntLatLng, 100, {
                        color: 'black',
                        weight: 1,
                        fillOpacity: 0.1
                        
                    }).addTo(map)
                                    
                    homicidePoint.bindPopup(injuryPop)                                  
    			}
    			//else if (pointData[5] == "TRUE") {
    			//	shootNoInjuryPoint = new L.Marker(new L.LatLng(a[0], a[1]), { title: noinjurypop, icon:shootNoInjuryIcon, riseOnHover:true }).bindPopup(noinjurypop).addTo(map); //map points
    			//}
    			else if (pointData.shoottag == "TRUE") {                        
                    var pntLatLng = new L.LatLng(pointData.lat, pointData.lng)
                    homicidePoint = new L.circle(pntLatLng, 80, {
                        color: 'blue',
                        stroke: false,
                        fillOpacity: 0.5
                        
                    }).addTo(map)
                                    
                    homicidePoint.bindPopup(shootPop)                                                
    			}
            
            }
            
        	//grab map info and plot
        	function showInfo(data) {
        	    // data comes through as a simple array since simpleSheet is turned on
        	    //alert("Successfully processed " + data.length + " rows!")
        	    for (i=0 ; i < data.length ; i++){
                    insertMapInfo = {
                        lat: parseFloat(data[i].latitude)
                        ,lng: parseFloat(data[i].longitude)
                        ,beat: data[i].beat
                        ,homicidetag: data[i].homicidetag
                        ,shootinjurytag: data[i].shootinjurytag
                        ,shootnoinjurytag: data[i].shootnoinjurytag
                        ,shoottag: data[i].shoottag
                        ,address: data[i].address
                        ,date: data[i].date
                        ,time: data[i].time
                        ,rd: data[i].rd
                        ,statute: data[i].statute
                        ,victims: data[i].victims
                        ,noofvictims: data[i].noofvictims
                    }
			
        			pointData.push(insertMapInfo)
        		}
        		for (var i = 0; i < pointData.length; i++) { 
                    
                    mapNewPoint(pointData[i]) 			
                    
                    $("#loading").hide();
			
        		}
        	}
	
        	//layer control
        	//var homicideLayer = L.layerGroup(homicides);
        	//L.control.layers(homicideLayer).addTo(map);
	
        	initTable();
        });
	
        // INITIALIZE MAP //
        
        
		//initalize layers
		//var homicideLayer = L.layerGroup([])
		
		//initalize map
		var map = L.map('map',{
			center: [37.781027,-122.22393],
			zoom: 12
			//layers: [homicideLayer]
		})
		
		// api settings
		L.tileLayer('http://{s}.tile.cloudmade.com/c74f93f2a2fc45b4a8a625de2e5bbbb8/998/256/{z}/{x}/{y}.png', {
		    attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://cloudmade.com">CloudMade</a>',
		    maxZoom: 18
		}).addTo(map);
    
    })

    </script>
	
	

  </body>
</html>
